#!/usr/bin/env python

import importlib
import os
import sys

bundle_name = os.getenv("COG_BUNDLE")
command_name = os.getenv("COG_COMMAND")

# `-` cannot be used in class names in python so
# since command_name is used directly for klass
# this doesn't break compatibility for existing bundles
# because if a bundle uses `-` in the command name
# pycog3 <= 0.1.27 throws exception
try:
    path = command_name.replace("-",".")
except AttributeError as e:
    print("ERROR: COG_COMMAND is empty")
    sys.exit(1)

full_path = "%s.commands.%s" % (bundle_name, path)
class_name = command_name.split("-")[-1].capitalize()

try:
    bundle_module = importlib.import_module(full_path)
except ModuleNotFoundError as e:
    print('ERROR: Unable to load module "' + str(path) + '"')
    sys.exit(1)

klass = getattr(bundle_module, class_name)
cmd = klass()
cmd.execute()
